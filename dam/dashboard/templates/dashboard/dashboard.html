{% extends 'base.html' %}

{% load static %}

{% block style %}
    <style>
        .profile {
            background-image: url({% static 'img/profile.png' %});
            border-radius: 50%;
            display: block;
            margin: auto;
            background-size: 100%;
            background-repeat: no-repeat;
            background-color: lightblue;
            height: 280px;
            width: 280px;
        }

        .card .card-content .card-title {
            margin: 8px 0 0;
        }

        .card .card-action a:not(.btn):not(.btn-large):not(.btn-small):not(.btn-large):not(.btn-floating) {
            color: #005bbb;
            line-height: 2.5;
            margin: 0 12px;
            white-space: nowrap;
        }
        .card .card-action a:not(.btn):not(.btn-large):not(.btn-small):not(.btn-large):not(.btn-floating):focus,
        .card .card-action a:not(.btn):not(.btn-large):not(.btn-small):not(.btn-large):not(.btn-floating):hover {
            color: #002f56;
        }
        #clients{
            background-color: var(--pgrey);
        }
        @media only screen and (max-width: 600px) {
            .profile {
                width: 220px;
                height: 220px;
            }
        }
    </style>

{% endblock %}

{% block title %}Dashboard{% endblock %}

{% block body %}
    <h1>Dashboard</h1>

    <div class="row">
        <div class="col s12 m10 offset-m1 l8 offset-l2">
            <div class="card" style="text-align: center;">
                <div class="card-content">
                    <div class="profile"></div>
                    <span class="card-title">{{ user.get_full_name }}</span>
                </div>

                {% if user.is_staff %}
                <div class="card-action dashboard-links">
                    {% if perms.loans.view_itemreservation %}<a href="{% url 'loans:allres' %}">Reserve Item List</a>{% endif %}
                    {% if perms.loans.view_itemloan %}<a href="{% url 'loans:allrets' %}">Return Item List</a>{% endif %}
                    {% if perms.inventory.add_item %}<a href="{% url 'admin:inventory_item_changelist' %}">Add/Remove Item</a>{% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12 m10 offset-m1 l5" id="clients" style="margin-bottom: 3%;" >
            <h5 class="card-title" style="color: #ffffff;text-align: center;">Your Reservations</h5>
            {% if reserves %}
                {% for reserve in reserves %}
                    {% if user.first_name.capitalize == reserve.client.first_name.capitalize %}
                        {% if user.last_name.capitalize == reserve.client.last_name.capitalize %}
                            <div class="card" style="min-height: 20%; margin-right: 3%; margin-left: 3% ">
                                <div class="card-content">
                                    <span class="card-title" style="color:black;">{{ reserve.item.name }}</span>
                                    <p>Reserved at: {{ reserve.reserved_at }}</p>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% else %}
                <h6 class="card-title" style="color: #ffffff;text-align: center;">No active reservations right now</h6>
            {% endif %}
        </div>

        <div class="col s12 m10 offset-m1 l5 offset-l2" id="clients">
            <h5 class="card-title" style="color: #ffffff; text-align: center;">Your Loans</h5>
            {% if returns %}
                {% for loan in returns %}
                    {% if user.first_name.capitalize == loan.client.first_name.capitalize %}
                        {% if user.last_name.capitalize == loan.client.last_name.capitalize %}
                            <div class="card" style="min-height: 20%; margin-right: 3%; margin-left: 3% ">
                                <div class="card-content">
                                    <span class="card-title" style="color:black;">{{ loan.item.name }}</span>
                                    <p>Approved at: {{ loan.approved_at }}</p>
                                    <p>Due at: </p>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% else %}
                <h6 class="card-title" style="color: #ffffff;text-align: center;">No active loans right now</h6>
            {% endif %}
        </div>
    </div>
    </div>
{% endblock %}
